<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don't Be Odd</title>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="vue_app">
        <h1>Don't Be Odd</h1>
        <input v-model.lazy="player_name" v-on:change="updatePlayerName()" placeholder="Enter your name">
        <p>Session Id: {{ session_id }}</p>
        <p>Player: {{ player }}</p>
        <h2>Playing Game: {{ game_id }}</h2>
        <p>Enjoy playing</p>
        {% raw %}
        <p>{{ player_name  }}</p>

        <li v-for="player in player_list" :key="player.id">
            {{ player.name }}
        </li>

        {% endraw %}
    </div>
</body>

<script type="module">
    const { createApp, ref } = Vue;

    function setup(){
        // special vue setup function
        const player_name = ref("");
        const player_list = ref([]);
        
        const interval = setInterval(poll_for_game_state, 1000); // poll

        function poll_for_game_state() {
            axios.get('/game/{{game_id}}/state')
            .then(update_page_from_game_state)
            .catch(function(error) {
                console.error('Error getting game state:', error);
            });
        }
        poll_for_game_state();

        function update_page_from_game_state(response) {
            console.log('Game state:', response.data);
            if (player_name.value === ""){
                    player_name.value = response.data.player_name;
                }

            player_list.value = response.data.player_list;
        }

        function updatePlayerName() {
            console.log('Updating player name to:', player_name);
            axios.post('/game/{{game_id}}/update_player_name/', {
                name: player_name.value
            })
            .then(function(response) {
                console.log('Player name updated:', response.data);
            })
            .catch(function(error) {
                console.error('Error updating player name:', error);
            });
        }

        return {
            player_name,
            player_list,
            interval,
            updatePlayerName,
        };
    }

    function mounted() {
        console.log('Vue app mounted');
    }

    var vue_app = createApp({setup, mounted})
    console.log('Vue app:', vue_app);
    vue_app.mount("#vue_app");
    



</script>

</html></html>